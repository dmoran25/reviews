import streamlit as st

# ---- FUNCTIONS ----
def calculate_new_rating(current_rating, total_reviews, target_rating):
    """
    Calculates the number of 5-star reviews needed to reach the target rating.
    """
    current_total = current_rating * total_reviews
    new_reviews_needed = 0

    while (current_total + (5 * new_reviews_needed)) / (total_reviews + new_reviews_needed) < target_rating:
        new_reviews_needed += 1

    return new_reviews_needed

def estimate_revenue_increase(new_reviews_needed, clv):
    """
    Estimates the additional revenue generated by acquiring more reviews.
    Assumes each review gets ~100 views per month and influences potential buyers.
    """
    estimated_revenue = new_reviews_needed * 100 * 0.05 * clv  # 100 views/month * 5% conversion * CLV
    return estimated_revenue


# ---- STREAMLIT UI ----
st.set_page_config(page_title="Google Reviews Impact Calculator", page_icon="â­")

# ðŸ”¥ Persuasive Header
st.title("ðŸš€ Google Reviews & Revenue Impact Calculator")
st.subheader("See how improving your online reviews can boost your business revenue!")

# ðŸ“Œ Sidebar for Inputs
st.sidebar.header("Step 1 of 2: Input Your Business Data")
current_rating = st.sidebar.slider("â­ Current Google Rating", 1.0, 5.0, 4.2, 0.1)
total_reviews = st.sidebar.number_input("ðŸ“Œ Current Number of Google Reviews", min_value=1, value=100, step=1)
target_rating = st.sidebar.slider("ðŸŽ¯ Desired Google Rating", 1.0, 5.0, 4.6, 0.1)
clv = st.sidebar.number_input("ðŸ’° Lifetime Customer Value ($)", min_value=10, value=1000, step=10)

# ðŸ§® Calculations
reviews_needed = calculate_new_rating(current_rating, total_reviews, target_rating)
revenue_increase = estimate_revenue_increase(reviews_needed, clv)

# ðŸ“Š Display results with better formatting
st.markdown("---")
st.subheader("ðŸ” Review Growth Insights")

col1, col2 = st.columns(2)
col1.metric(f"â­ Reviews Needed to Get to {target_rating}", f"{reviews_needed} more 5-stars", delta=f"+{reviews_needed}")
col2.metric("ðŸ’° Estimated Monthly Revenue Increase", f"${revenue_increase:,.2f}")

st.progress(min(reviews_needed / 100, 1.0))  # Simple progress bar for visuals

# ðŸŽ¯ Explanation Behind the Calculation
st.markdown("---")
st.subheader("ðŸ“ˆ How These Estimates Work")
st.write(
    f"""
    **Why a 5% Conversion Rate?**  
    - Based on local business benchmarks, a **5% conversion rate** from new views generated by reviews is a solid estimate.
    - Businesses with optimized Google Business Profiles and active reviews often reach **5-10% conversion rates**.
    - **High-intent searches ("best near me")** make users more likely to convert.
    
    **How We Calculate Revenue Increase:**  
    - Each **new review** brings in **~100 more views per month**.
    - **5% of those views** (5 out of every 100 people) will take action (call, visit, book, or buy).
    - If your average customer lifetime value is **${clv}**, then every **new review** can bring measurable revenue growth.
    
    **Example:**  
    - If you need **{reviews_needed} more 5-star reviews** to reach **{target_rating}**, and each review brings in potential new customers, your estimated **monthly revenue increase** is **${revenue_increase:,.2f}**.
    """
)

# ðŸŽ¯ Call-To-Action Section
st.markdown("---")
st.subheader("ðŸ”¥ Take Action Today!")

st.markdown(
    """
    - More **positive reviews** = **higher Google ranking**
    - More **visibility & trust** = **more customers**
    - More **customers** = **more revenue!**
    """
)
st.success("Want to **start generating more 5-star reviews effortlessly?** Let's talk!")

# ðŸ“© Optional Email Capture for Follow-Ups
email =
